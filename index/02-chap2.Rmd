
# Chapter 2. Post-processing and Filtration of the Sequence Table
The ASV table produced by Alex Sibley consisted of seven different bathces of stool samples produced by MSK. These distinct tables were merged into a single ASV table, with columns representing different ASVs, rows representing sampling, and counts in the table representing the abundance of each ASV in each of our samples.

DADA2 was used to remove chimeric sequences from the sequence table by comparing each inferred sequence to others in the table, and removing those that could be reproduced by stitching together two more abundant sequences. The DADA2 naive Bayesian classifier was then used to compare sequence variants to the RDP v14 training set of classified sequences (Cole 2013). Through this process, each ASV column is assigned a full taxonomy, including Kingdom, Phylum, Class, Order, Family, and Genus.

In addition to assigning taxonomies, we associated deidentified metadata to our stool samples, also provided to us by Memorial Sloan Kettering. The metadata were imported, cleaned, and subsetted to match our ASV table. Finally, the R "phyloseq" package was applied to combine our ASV feature table, our metadata, and our sequence taxonomies of our amplicon sequencing experiment into a single object (McMurdle 2013).

With our full phyloseq object, we then used our assigned taxonomies as a filtering criterion on our data. This filtration process helps us to avoid spending unneeded time on taxa that are seen too infrequently and eliminates extra noise by deleting taxa that are simply artifacts of data collection.

We created a table of read counts for each Phylum present in our dataset.

<p>
---------------------------------------------
  Phyla                        Read Counts      
----------------------------- ---------------
  Actinobacteria                  3864
  
  Armatimonadetes                 1
  
  Bacteroidetes                   3375
  
  Chlamydiae                      3
  
  Cyanobacteria/Chloroplast       15
  
  Deferribacteres                 1
  
  Deinococcus-Thermus             3
  
  Euryarchaeota                   2
  
  Firmicutes                      155578
  
  Fusobacteria                    19
  
  Proteobacteria                  3481
  
  Spirochaetes                    4
  
  Synergistetes                   84
  
  Tenericutes                     3
  
  Verrumicrobia                   8823
  
  Woesearchaeota                  1578
  
  <NA>                            211134
----------------------------- ---------------
Table: Correlation of Inheritance Factors for Parents and Child 

</p>

Many of our features are annotated with a phylum of "NA," potentially indicating that they are artifacts. However, due to the fact that databases such as the RDP are often far from complete, filtering out all of these datapoints was considered to be too stringent. As a result, they were kept in our dataset.

We also explored feature prevalence in our dataset. Feature prevalence is defined to be the number of samples in which a taxum appears at least once. We computed the average and total prevalences of the features in each phylum to determine if there were any phyla that consisted mostly of low-prevalence features.

<p>
----------------------------------------------------------------------------------
  Phylum                       Average Abundance       Total Abundance
---------------------------- ---------------------- ---------------------
  Actinobacteria                  2.612319                10094
  
  Armatimonadetes                 1.000000                1
  
  Bacteroidetes                   3.135111                10581
  
  Chlamydiae                      1.000000                3
  
  Cyanobacteria/Chloroplast       3.133333                47
  
  Deferribacteres                 7.000000                7
  
  Deinococcus-Thermus             2.333333                7
  
  Euryarchaeota                   25.000000               50
  
  Firmicutes                      1.952770                303808
  
  Fusobacteria                    4.473684                85
  
  Proteobacteria                  3.381212                11770
  
  Spirochaetes                    1.500000                6
  
  Synergistetes                   1.880952                158
  
  Tenericutes                     2.333333                7
  
  Verrucomicrobia                 1.706562                15057
  
  Woesearchaeota                  3.147022                4966
  
  <NA>                            1.977450                417507
---------------------------- ---------------------- ---------------------
Table: Feature Prevalence of Phyla in our Dataset 

</p>

Through this process, we dropped the following phyla from our dataset: Armatimonadetes, Chlamydiae, Deferribacteres, Deinococcus-Thermus, Spirochaetes, and Tenericutes

The previous filtration steps required our taxonomic annotations to properly work. Without taxonomies, we can use prevalence filtering as a form of unsupervised filtration to further streamline our data. We plotted graphs of prevalence against total abundance for each phylum in an effort to identify an appropriate prevalence threshold (Figure 3).

<p>
![Feature Prevalence of Phyla against Total Abundance in our Dataset](/Users/viveksriram/Desktop/ThesisFigures/figure3.png)

</p>

We failed to see see any real separation in our plots, so we established an arbitrary prevalence threshold of 1%.

In order to account for differences in library size, variance, and scale, we had to use relative abundances instead of total abundances. We transformed our data from counts to frequencies, and also applied a log transformation. We then applied Principal Coordinates Analysis (PCoA) with Bray-Curtis dissimilarity to our transformed data.

We visualized ordination plots of the samples in our dataset, as well as of the distribution of taxa present in each sample (Figure 4).

<p>
![Ordination Plots of Samples and of Phyla](/Users/viveksriram/Desktop/ThesisFigures/figure4.png)

</p>

In addition to looking at the specific distribution of phyla for our samples, we can color-code the different datapoints representing each of our samples to determine if there are any obvious clustering patterns based upon the covariates in our metadata. In the following two plots, we visualize vital status and graft source for our patients across all time points (Figures 5 and 6).

<p>
![Ordination Plot of Samples, colored by Vital Status](/Users/viveksriram/Desktop/ThesisFigures/figure5.png)

</p>

<p>
![Ordination Plot of Samples, colored by Graft Source](/Users/viveksriram/Desktop/ThesisFigures/figure6.png)

</p>

While these visualizations revealed some information into the distributions of bacteria in our samples, we failed to see any obvious trends across our categories. Another key issue with our plots is that we were unable to clearly identify how a single patient's sample would change over time. To quantify the dynamics of a patient's microbiome in our ordination plot, we devised two different summary statistics: maximum distance and last distance.

We began by creating a Scree plot to determine the contributions of our different principal coordinate axes (Figure 7).

<p>
![Scree Plot of Contributions from PCoA Axes](/Users/viveksriram/Desktop/ThesisFigures/figure7.png)

</p>

Analyzing the plot and computing the contributions of our axes, we see that the first 17 axes constitute the the majority of contributions from our 460 total axes. So, we used these axes as part of our distance metrics; we calculated the distance from one sample to another by taking the square root of the sum of the squared differences of each of our seventeen components. 

Given an individual patient in our dataset, maximum distance is defined as the furthest distance in the ordination plot traveled from the patient's earliest point. Last distance is defined as the distance between the individual's earliest and latest point in the ordination plot. A potential future avenue to explore in this scenario is to scale principal components relative to one another instead of simply using the first seventeen, in an effort to get a better quantification of our two metrics. With our processed dataset and ordination plot, and our new summary statistics, we turned to the visualization application "Tableau."